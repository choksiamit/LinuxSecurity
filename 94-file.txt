# custom firewall for a web hosting server

allow incoming connections to all running services
mgmt 5 ssh 
no more than 50 concurrent CONNECTIONS
all traffic from same hosts allowed


#!/bin/bash

iptables -F INPUT
iptables -F OUTPUT

# permit loopback interface
iptables -A INPUT -s lo -j ACCEPT
iptables -A OUTPUT -s lo -j ACCEPT

permit_tcp="20 21 25 465 80 443 110 143"

for p in $permit_tcp
do
    iptables -A INPUT --dport $p 
             -j ACCEPT 
done

#tcp

#udp


PERMIT_SSH=" 1 2 3 4"

for p in $PERMIT_SSH
do 
    iptables -A INPUT -p tcp --dport $p 
    -j ACCEPT
done

# no more than 50 concurrent connections

iptables -A INPUT -d tcp -m multiport --dport 80,443
-m connlimit --connlimit-above=50 -j ACCEPT

# permit all traffic from the following mac addresses
mac_addresses = "x x x x y"

for p in $mac_addresses
do 
    iptables -A INPUT -p tcp --dport $p 
    -j ACCEPT
done

# traffic generated by our server
iptables -A OUTPUT -m state --state NEW, ESTABLOISHED,
    RELATED -j ACCEPT

# fix this script
iptables -A INPUT -m state ==state INVALID

iptables-save > file.txt



